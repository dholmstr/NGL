<!DOCTYPE html>
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="lib/class_manager.js"></script>
    <script src="lib/digitransit_manager.js"></script>
    <script src="lib/map_manager.js"></script>
</head>
<body>
<div id="map" style="width:400px; height: 400px; float:left"></div>
<div id="directions" style="width:400px; height: 400px; float:left"></div>
<div id="itineraries" style="width:400px; height: 400px; float:left"></div>
<script>

    var mapManager = new MapManager({
        'mapContainerId' : 'map',
        'directionsContainerId': 'directions',
        'apiKey' : 'AIzaSyAq4CZxYBwQ3Mf3RDJGH6CYUbBU1nonVpI'
    }, function() {

        mapManager.renderRoute('Gamla landsvÃ¤gen 6, 02650 Esbo', 'Metropolia Bulavardi Helsinki');

        var digitransitManager = new DigitransitManager();

        var from = {
            lat:60.199196699999995,
            lon:24.9397302
        };

        var to = {
            lat:60.168438,
            lon:24.929283
        };

        digitransitManager.getPlans(from, to, function(result){
            console.log('Result in callback');
            console.log(result);
            if(typeof result === 'object' && typeof result.data === 'object'
                    && typeof result.data.plan === 'object'
                    && typeof result.data.plan.itineraries === 'object'){
                console.log('result is ok');
                result = result.data.plan.itineraries;
                if(result.length > 0){
                    console.log('there are plans');

                    var list = $("<ul class='itineraries-list'></ul>");
                    $('#itineraries').html('').append(list);

                    $.each(result, function(i, v){
                        var item = $("<li class='itineraries-item'></li>");
                        console.log(item);
                        if(v.duration){
                            // TODO: _secondsToHuman
                            $("<span class='duration'>" + v.duration + "</span>").appendTo(item);
                        }
                        if(v.walkDistance){
                            // TODO: walkDistanceToHuman
                            $("<span class='walkDistance'>" + v.walkDistance + "</span>").appendTo(item);
                        }

                        console.log(result);
                        $(list).append(item);
                    });
                } else {
                    console.log('no plans');
                    // TODO: Show appropriate message
                }

            } else {
                console.log('error processing plans');
                console.log(result);
                // TODO: Show appropriate message to the user
            }
        }, true);
    });


</script>
</body>
</html>